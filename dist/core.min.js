var typeOf=(function(){var a=(new Array).constructor,d=(new Date).constructor,b=(new RegExp).constructor;return function c(f){var e=typeof(f);if(e=="object"||e=="function"){if(f===null){return"null"}if(f.constructor==a){return"array"}if(f.constructor==d){return"date"}if(f.constructor==b){return"regexp"}}return e}})();var Native={extend:function(a,b,c,d){if(typeof a[b]=="undefined"||d){a[b]=c}},extendAll:function(b,a,d){for(var c in a){if(a.hasOwnProperty(c)){Native.extend(b,c,a[c],d)}}},implement:function(a,b,c,d){if(typeof a.prototype[b]=="undefined"||d){a.prototype[b]=c}},implementAll:function(b,a,d){for(var c in a){if(a.hasOwnProperty(c)){Native.implement(b,c,a[c],d)}}}};Native.extendAll(Array,{from:function(a){if(a==null){return[]}return(Var.isEnumerable(a)&&typeof a!="string")?(typeOf(a)=="array")?a:Array.prototype.slice.call(a):(typeOf(a)=="string")?a.split(" "):[a]}});Native.implementAll(Array,{forEach:function(c,d){for(var b=0,a=this.length;b<a;b++){if(b in this){c.call(d,this[b],b,this)}}},each:function(a,b){return this.forEach(a,b)},includes:function(){for(var a=0,b=arguments.length;a<b;a++){if(this.indexOf(arguments[a])==-1){return false}}return true},first:function(){if(arguments.length==1&&Var.isFunction(arguments[0])){var b=arguments[0];for(var a=0;a<this.length;a++){if(b.call(this,this[a])){return this[a]}}return false}else{return this[0]}},last:function(){if(arguments.length==1&&Var.isFunction(arguments[0])){var b=arguments[0];for(var a=this.length-1;a>=0;a--){if(b.call(this,this[a])){return this[a]}}return false}else{return this[this.length-1]}},without:function(){var a=Array.from(arguments);return this.filter(function(b){return !a.includes(b)})},min:function(){return Math.min.apply(Math,this)},max:function(){return Math.max.apply(Math,this)},uniq:function(){return[].merge(this)},compact:function(){return this.without(null,[][0])},merge:function(){for(var e=this.clone(),a,c=0,b,d=arguments.length;c<d;c++){a=arguments[c];a=Var.isArray(a)?a:[a];for(b=0;b<a.length;b++){if(e.indexOf(a[b])==-1){e.push(a[b])}}}return e},clone:function(){return this.slice(0)},isEmpty:function(){return !this.length},flatten:function(){var a=[];this.forEach(function(b){if(Var.isArray(b)){a=a.concat(b.flatten())}else{a.push(b)}});return a},});Native.implementAll(Function,{bind:function(){var d=this,a=Array.from(arguments),b=a.shift();return function c(){var e=a.concat(Array.from(arguments));return d.apply(b,e)}},delay:function(){var a=Array.from(arguments),b=a.shift(),c=new Number(window.setTimeout(this.bind.apply(this,[this].concat(a)),b));c.cancel=function(){window.clearTimeout(this)};return c},periodical:function(){var a=Array.from(arguments),b=a.shift(),c=new Number(window.setInterval(this.bind.apply(this,[this].concat(a)),b));c.stop=function(){window.clearInterval(this)};return c}});if(window.JSON){Native.extend(JSON,"translate",function translate(b){return function a(c,d){if(c in b){switch(b[c]){case"Date":return new Date(Date(d));case"Time":return new Date(Date(d)).getTime();case"int":return parseInt(d);case"float":return parseFloat(d);case"bool":return(d)?true:false;case"String":return(d)?true:false;default:return d.toString()}}else{return d}}})}Native.extendAll(Math,{randomBetween:function(b,a){return Math.floor(Math.random()*(a-b+1)+b)}});Native.extendAll(Number,{random:function(b,a){return Math.randomBetween(b,a)}});Native.implementAll(Number,{times:function(b,c){for(var a=0;a<this;a++){b.call(c,a,this)}}});Native.extendAll(Object,{extend:function(d,b,a){for(var c in b){if(b.hasOwnProperty(c)){if(c in d){if(!a){d[c]=b[c]}}else{d[c]=b[c]}}}return d},keys:function(a){var c=new Array();for(var b in a){if(a.hasOwnProperty(b)){c.push(b)}}return c},values:function(b){var a=[],c;for(var c in b){a.push(b[c])}return a},isEmpty:function(a){for(var b in a){break}return !b},without:function(){var c=Array.from(arguments).flatten(),a=c.shift(),d={},b;for(b in a){if(!c.includes(b)&&a.hasOwnProperty(b)){d[b]=a[b]}}return d},only:function(){var c=Array.from(arguments).flatten(),a=c.shift(),e={},b=0,d=c.length;for(;b<d;b++){if(c[b] in a){e[c[b]]=a[c[b]]}}return e},merge:function(){var a={},b=0,c=arguments.length;for(;b<c;b++){if(Var.isHash(arguments[b])){Object.extend(a,arguments[b])}}return a},toQueryString:function(a){var c=[],b;for(var b in a){c.push(b+"="+encodeURIComponent(a[b]))}return c.join("&")},fromQueryString:function(a){if(a.startsWith("?")){a=a.substring(1)}var b={};a.split("&").each(function(d){var c=d.split("=");key=unescape(c.shift()),value=unescape(c.join("="));b[key]=value});return b},getPrototypeOf:(function(b){if(b){return function a(c){return c.__proto__}}else{return function a(c){return c.constructor.prototype}}})({}.__proto__),setPrototypeOf:(function(a){if(a){return function b(d,c){d.__proto__=c;return d}}else{return function b(e,c){for(var d in c){e.constructor.prototype[d]=c[d]}return e}}})({}.__proto__)});if(!("defineProperty" in Object)&&"__defineGetter__" in Object.prototype){Object.extend("defineProperty",function(c,b,a){if("get" in a){c.__defineGetter__(b,a.get)}if("set" in a){c.__defineSetter__(b,a.set)}if("value" in a){if("set" in a){a.call(c,a.value)}else{c[b]=a.value}}})}Native.implementAll(String,{toSlug:function(){return this.trim().toLowerCase().replace(/[^-a-z0-9~\s\.:;+=_]/g,"").replace(/[\s\.:;=_+]+/g,"-").replace(/[\-]{2,}/g,"-")},merge:function(a){a=Var.isHash(a)?a:Array.from(arguments).flatten();return this.replace(/\{([\w\.]*)\}/g,function(e,b){var c=b.split("."),d=a[c.shift()];c.each(function(f){d=d[f]});return(d===null||d===undefined)?"":d})},blank:function(){return/^\s*$/.test(this)},trim:String.prototype.trim||function(){var b=this.replace(/^\s\s*/,""),a=b.length;while(/\s/.test(b.charAt(--a))){}return b.slice(0,a+1)},stripTags:function(){return this.replace(/<\/?[^>]+>/ig,"")},camelize:function(){return this.replace(/(\-|_)+(.)?/g,function(a,c,b){return b?b.toUpperCase():""})},underscored:function(){return this.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-/g,"_").toLowerCase()},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},includes:function(a){return this.indexOf(a)!=-1},startsWith:function(a,b){var c=this.substr(0,a.length);return b?c.toLowerCase()===a.toLowerCase():c===a},endsWith:function(a,b){var c=this.substring(this.length-a.length);return b?c.toLowerCase()===a.toLowerCase():c===a},toInt:function(a){return parseInt(this,a||10)},toFloat:function(a){return parseFloat(a?this:this.replace(",",".").replace(/(\d)-(\d)/g,"$1.$2"))}});var Var={isEnumerable:function(a){return(a!=null&&typeof a.length=="number"&&toString.call(a)!="[object Function]")},isDefined:function(a){return typeOf(a)!="undefined"},isFunction:function(a){return typeOf(a)==="function"},isObject:function(a){return typeOf(a)=="object"},isHash:function(a){return a.toString()==="[object Object]"},isArray:function(a){return typeOf(a)=="array"},isRegExp:function(a){return typeOf(a)=="regexp"},isDate:function(a){return typeOf(a)=="date"},isBoolean:function(a){return typeOf(a)=="boolean"},isBool:function(a){return this.isBoolean(a)},isNumber:function(a){return typeOf(a)=="number"},isNull:function(a){return typeOf(a)=="null"},isNaN:function(a){return typeOf(a).toLowerCase()=="nan"},isElement:function(a){return(a instanceof HTMLElement)}};function module(name,definition){var current_constructor,parent_klass,global=this,lastLogGroup=null,propertyCache={};if(!global[name]){global[name]={};for(var prop in module.coreMethods){global[name][prop]=module.coreMethods[prop]}}var module_stack=[global[name]],module_path=[name];function current_module(){return module_stack[module_stack.length-1]}function push_module(name){if(!current_module()[name]){current_module()[name]={}}var module=current_module()[name];module_stack.push(module);module_path.push(name);return module}function pop_module(){module_stack.pop();module_path.pop()}function fullpath(name){return module_path.join(".")+"."+name}function clone(object){var cleaned={};for(var name in object){if(object.hasOwnProperty(name)){cleaned[name]=object[name]}}return cleaned}function cache_property(path,prop,def){if(!propertyCache[path]){propertyCache[path]={}}propertyCache[path][prop]=def}function has_super(name){if(parent_klass){var parent=parent_klass.prototype,inside=(name in parent),anctrs=(current_constructor)?current_constructor.ancestors.first(function(proto){return name in proto&&Var.isFunction(proto[name])}):false;return inside||anctrs}return false}function get_super(name){var ancestor=current_constructor.ancestors.first(function(proto){return proto.hasOwnProperty(name)&&Var.isFunction(proto[name])});console.log(" super."+name+" from: "+ancestor.klass.displayName);console.dir(ancestor[name]);return ancestor[name]}var excludeFields=Array.from("klass superKlass didSubklass ancestors className displayName").concat(Object.keys(module.coreMethods)).flatten();function build_class(name,definition,parent){parent_klass=parent;current_constructor=function(){if(this.initialize){this.initialize.apply(this,arguments)}};current_constructor.ancestors=[];current_constructor.displayName=name;current_constructor.className=fullpath(name);current_constructor.prototype.klass=current_constructor;if(parent){console.log(name+" is subklassing: "+parent.displayName);var grandparent=parent.prototype,parentProps=(parent.className in propertyCache)?Object.keys(propertyCache[parent.className]):[],exclusions=excludeFields.clone().concat(parentProps).flatten();current_constructor.prototype=Object.without(parent.prototype,exclusions);current_constructor.prototype.klass=current_constructor;current_constructor.prototype.superKlass=parent;for(var prop in Object.without(parent,exclusions)){console.log(" + static method: "+prop);current_constructor[prop]=parent[prop]}for(var i=0;i<parentProps.length;i++){var prop=parentProps[i];console.log(" @ property: "+prop);this.property(prop,propertyCache[parent.className][prop])}while(grandparent){console.log(" > ancestor chain: "+grandparent.klass.displayName);current_constructor.ancestors.push(grandparent);grandparent=("superKlass" in grandparent)?grandparent.superKlass.prototype:false}}this.include(module.coreMethods);definition.call(current_constructor);current_module()[name]=current_constructor;if(parent&&"didSubklass" in parent){parent.didSubklass(current_constructor)}current_constructor=undefined;parent_klass=undefined}var keywords={module:function(name,definition){var module=push_module(name);this.include(module.coreMethods);definition.call(module);pop_module()},klass:function(name,definition){build_class.call(this,name,definition,false)},subklass:function(parent,name,definition){build_class.call(this,name,definition,parent)},include:function(mixin){for(var prop in mixin){this.define(prop,mixin[prop])}},define:function(name,item){if(current_constructor){current_constructor.prototype[name]=item}else{current_module()[name]=item}},method:function(name,fn){if(has_super(name)){var superFn=get_super(name);this.define(name,function(){this._super=superFn;return fn.apply(this,arguments)})}else{this.define(name,fn)}},ctor:function(fn){this.method("initialize",fn)},alias:function(oldName,newName){var fn=(current_constructor)?current_constructor.prototype[oldName]:current_module()[oldName];this.define(newName,fn)},staticMethod:function(name,fn){if(name in current_constructor){var superFn=current_constructor[name];current_constructor[name]=function(){this._super=superFn;return fn.apply(this,arguments)}}else{current_constructor[name]=fn}},property:function(name,definition){if(current_constructor){cache_property(current_constructor.className,name,definition);Object.defineProperty(current_constructor.prototype,name,definition)}else{cache_property(module_path.join("."),name,definition);Object.defineProperty(current_module(),name,definition)}},properties:function(props){for(var name in props){this.property(name,props[name])}},log:function(){if(!module.debug){return}var caller_name=module_path.join(".");if(window.console&&console.log){if(caller_name&&console.group&&caller_name!=lastLogGroup){console.groupEnd();console.group(caller_name+" ("+(new Date()).getTime()+")");lastLogGroup=caller_name}var args=Array.prototype.slice.call(arguments);args.forEach(function(arg){console.log(arg)})}}};with(current_module()){with(keywords){eval("("+definition+")").call(current_module(),keywords)}}}module.coreMethods={method:function(){var b=this,c=Array.prototype.slice.call(arguments),a=b[c.shift()];return function d(){return a.apply(b,c.concat(Array.prototype.slice.call(arguments)))}},fire:function(a,b){if(!this.__listeners||!(a in this.__listeners)){return}this.__listeners[a].forEach(function(c){c.call(this,b)});return this},on:function(a,b){if(!this.__listeners){this.__listeners={}}if(!(a in this.__listeners)){this.__listeners[a]=[]}this.__listeners[a].push(b);return this},observe:function(a,b){return this.on(a,b)},stopObserving:function(a,b){if(!this.__listeners||!(a in this.__listeners)){return}if(b){this.__listeners[a]=this.__listeners[a].filter(function(c){return c!==b})}else{this.__listeners[a]=[]}return this}};module.debug=false;